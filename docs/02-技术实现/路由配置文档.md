# Web3 Alpha Hunter - 路由配置文档

> 生成时间: 2025-10-14
> 文档版本: v1.0

## 1. 项目架构概览

```
faxianjihui/
├── backend/          # FastAPI后端
│   └── app/
│       ├── main.py   # 应用入口
│       └── api/v1/   # API路由模块
└── frontend/         # Next.js前端
    └── src/
        ├── app/      # Next.js 14 App Router
        └── lib/      # API客户端
```

## 2. 后端API路由结构

### 2.1 主入口配置

**文件**: `backend/app/main.py`

- **应用根路由**: `/`
- **API文档**: `/docs` (Swagger UI)
- **API替代文档**: `/redoc` (ReDoc)
- **健康检查**: `/health`
- **API前缀**: `/api/v1` (所有业务路由)

### 2.2 API v1 路由模块

**注册文件**: `backend/app/api/v1/__init__.py`

#### 完整路由映射表

| 模块 | 前缀 | Tags | 文件 | 说明 |
|-----|------|------|------|------|
| **项目管理** | `/api/v1/projects` | `projects` | `projects.py` | 项目列表、详情、历史 |
| **仪表盘** | `/api/v1/dashboard` | `dashboard` | `dashboard.py` | 实时统计、大屏数据 |
| **管理后台** | `/api/v1/admin` | `admin` | `admin.py` | AI配置、任务控制 |
| **数据库工具** | `/api/v1/database` | `database` | `database.py` | 数据库管理、测试 |
| **用户管理** | `/api/v1/users` | `users` | `users.py` | 用户CRUD、登录 |
| **平台管理** | `/api/v1/platforms` | `platforms` | `platforms.py` | 数据源平台管理 |
| **KOL管理** | `/api/v1/kols` | `kols` | `kols.py` | KOL数据管理 |
| **AI分析** | `/api/v1/analyze` | `analyze` | `analyze.py` | AI项目分析 |
| **测试接口** | `/api/v1/test` | `test` | `test.py` | 数据采集测试 |

---

## 3. 详细路由清单

### 3.1 项目管理 (`/api/v1/projects`)

```python
GET    /api/v1/projects              # 获取项目列表(支持筛选、分页)
GET    /api/v1/projects/{project_id} # 获取项目详情
GET    /api/v1/projects/{project_id}/history  # 获取项目历史数据
```

**查询参数**:
- `grade`: S/A/B/C (项目等级)
- `category`: DeFi/NFT/GameFi/... (项目分类)
- `blockchain`: Ethereum/Solana/... (区块链)
- `min_score`: 0-100 (最低评分)
- `sort_by`: score/discovered_at (排序字段)
- `order`: asc/desc (排序方向)
- `page`: 页码 (默认1)
- `limit`: 每页数量 (默认20, 最大100)

### 3.2 仪表盘 (`/api/v1/dashboard`)

```python
GET    /api/v1/dashboard/stats                # 实时统计数据
GET    /api/v1/dashboard/recent               # 最近发现的项目
GET    /api/v1/dashboard/top-projects         # Top高分项目
GET    /api/v1/dashboard/grade-distribution   # 等级分布
GET    /api/v1/dashboard/category-stats       # 类别统计
GET    /api/v1/dashboard/activity-timeline    # 活动时间线
GET    /api/v1/dashboard/summary              # 大屏汇总(一次获取所有)
```

### 3.3 管理后台 (`/api/v1/admin`)

#### 3.3.1 Celery任务控制

```python
GET    /api/v1/admin/celery-status            # 检查Celery运行状态
POST   /api/v1/admin/celery/worker/{action}   # 控制Worker(start/stop)
POST   /api/v1/admin/celery/beat/{action}     # 控制Beat(start/stop)
```

#### 3.3.2 数据采集

```python
POST   /api/v1/admin/collect/{source}         # 手动触发采集
                                               # source: twitter/telegram/coingecko/all
GET    /api/v1/admin/tasks/status             # 获取定时任务状态
```

#### 3.3.3 AI配置管理

```python
GET    /api/v1/admin/ai-configs               # 获取AI配置
POST   /api/v1/admin/ai-configs               # 保存AI配置(加密)
POST   /api/v1/admin/test-ai                  # 测试AI连接
GET    /api/v1/admin/ai-work-config           # 获取AI工作配置
POST   /api/v1/admin/ai-work-config           # 更新AI工作配置
```

#### 3.3.4 项目审核

```python
GET    /api/v1/admin/pending-projects         # 获取待审核项目
POST   /api/v1/admin/pending-projects/{id}/approve  # 批准项目
POST   /api/v1/admin/pending-projects/{id}/reject   # 拒绝项目
```

### 3.4 数据库工具 (`/api/v1/database`)

```python
GET    /api/v1/database/test-connection       # 测试数据库连接
POST   /api/v1/database/init                  # 初始化数据库
POST   /api/v1/database/reset                 # 重置数据库
GET    /api/v1/database/tables                # 列出所有表
GET    /api/v1/database/stats                 # 数据库统计
POST   /api/v1/database/seed                  # 填充示例数据
POST   /api/v1/database/backup                # 备份数据库
POST   /api/v1/database/restore               # 恢复数据库
POST   /api/v1/database/vacuum                # 清理数据库
GET    /api/v1/database/query                 # 执行SQL查询
```

### 3.5 用户管理 (`/api/v1/users`)

```python
GET    /api/v1/users                          # 获取用户列表
POST   /api/v1/users                          # 创建用户
GET    /api/v1/users/{user_id}                # 获取用户详情
PUT    /api/v1/users/{user_id}                # 更新用户
DELETE /api/v1/users/{user_id}                # 删除用户
POST   /api/v1/users/login                    # 用户登录
POST   /api/v1/users/init-default             # 初始化默认用户
```

### 3.6 平台管理 (`/api/v1/platforms`)

```python
GET    /api/v1/platforms                      # 获取平台列表
POST   /api/v1/platforms                      # 添加平台
GET    /api/v1/platforms/{platform_id}        # 获取平台详情
PUT    /api/v1/platforms/{platform_id}        # 更新平台
DELETE /api/v1/platforms/{platform_id}        # 删除平台
GET    /api/v1/platforms/{platform_id}/stats  # 获取平台统计
```

### 3.7 KOL管理 (`/api/v1/kols`)

```python
GET    /api/v1/kols                           # 获取KOL列表
POST   /api/v1/kols                           # 添加KOL
GET    /api/v1/kols/{kol_id}                  # 获取KOL详情
PUT    /api/v1/kols/{kol_id}                  # 更新KOL
DELETE /api/v1/kols/{kol_id}                  # 删除KOL
GET    /api/v1/kols/{kol_id}/projects         # 获取KOL推荐的项目
```

### 3.8 AI分析 (`/api/v1/analyze`)

```python
POST   /api/v1/analyze/project                # 完整AI项目分析
POST   /api/v1/analyze/quick-score            # 快速评分(无LLM)
POST   /api/v1/analyze/risk-check             # 风险检查
```

**请求体示例**:
```json
{
  "text": "项目描述文本",
  "source": "twitter",
  "author": {
    "username": "VitalikButerin",
    "followers": 5000000
  },
  "engagement": {
    "likes": 5000,
    "retweets": 1200
  }
}
```

### 3.9 测试接口 (`/api/v1/test`)

```python
GET    /api/v1/test/twitter-collection        # 测试Twitter采集
GET    /api/v1/test/telegram-collection       # 测试Telegram采集
GET    /api/v1/test/all-sources               # 测试所有数据源
```

---

## 4. 前端路由结构

### 4.1 Next.js App Router 页面

**框架**: Next.js 14 (App Router)
**路径**: `frontend/src/app/`

| 路由路径 | 文件 | 页面说明 |
|---------|------|---------|
| `/` | `page.tsx` | 首页/仪表盘 |
| `/projects` | `projects/page.tsx` | 项目列表 |
| `/projects/[id]` | `projects/[id]/page.tsx` | 项目详情 |
| `/admin` | `admin/page.tsx` | 管理后台 |
| `/admin-tools` | `admin-tools/page.tsx` | 管理工具 |
| `/review` | `review/page.tsx` | 项目审核 |
| `/database` | `database/page.tsx` | 数据库管理 |
| `/users` | `users/page.tsx` | 用户管理 |
| `/compare` | `compare/page.tsx` | 项目对比 |
| `/docs` | `docs/page.tsx` | 文档页面 |
| `/api-docs` | `api-docs/page.tsx` | API文档 |
| `/login` | `login/page.tsx` | 登录页面 |

### 4.2 前端API客户端

**文件**: `frontend/src/lib/api.ts`

```typescript
// Axios配置
baseURL: process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000/api/v1'

// 项目API
projectsApi.list(params)           // GET /projects
projectsApi.getById(id)            // GET /projects/{id}
projectsApi.getHistory(id, params) // GET /projects/{id}/history

// 用户API
usersApi.login(username, password) // POST /users/login
usersApi.list()                    // GET /users
usersApi.create(data)              // POST /users
usersApi.update(id, data)          // PUT /users/{id}
usersApi.delete(id)                // DELETE /users/{id}
```

---

## 5. 路由命名规范

### 5.1 后端路由规范

1. **RESTful风格**: 使用标准HTTP方法(GET/POST/PUT/DELETE)
2. **资源命名**: 使用复数名词(`/projects`, `/users`)
3. **路径参数**: 使用`{resource_id}`格式
4. **查询参数**: 使用snake_case(`min_score`, `sort_by`)
5. **前缀统一**: 所有业务路由使用`/api/v1`前缀

### 5.2 前端路由规范

1. **文件系统路由**: 基于Next.js App Router
2. **动态路由**: 使用`[id]`语法
3. **嵌套路由**: 通过文件夹层级实现
4. **布局共享**: 通过`layout.tsx`实现

---

## 6. CORS配置

**后端配置** (`backend/app/main.py`):
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.get_cors_origins_list(),
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

**环境变量**:
```env
CORS_ORIGINS="http://localhost:3000,http://localhost:8000"
```

---

## 7. 路由状态检查

### 检查后端路由
```bash
# 访问Swagger文档
http://localhost:8000/docs

# 健康检查
curl http://localhost:8000/health

# 查看所有路由
curl http://localhost:8000/api/v1/
```

### 检查前端路由
```bash
# 启动开发服务器
cd frontend && npm run dev

# 访问
http://localhost:3000
```

---

## 8. 常见问题

### 8.1 路由404错误

**可能原因**:
1. API前缀错误(缺少`/api/v1`)
2. 后端服务未启动
3. CORS配置问题
4. 路由未正确注册到`api_router`

**解决方法**:
```bash
# 检查后端日志
cd backend && uvicorn app.main:app --reload

# 检查路由注册
grep -r "include_router" backend/app/api/v1/__init__.py
```

### 8.2 前端API调用失败

**检查清单**:
1. 环境变量`NEXT_PUBLIC_API_URL`是否正确
2. 后端CORS是否允许前端域名
3. 网络请求是否被浏览器拦截
4. API路径是否正确(注意前缀)

---

## 9. 路由扩展指南

### 9.1 添加新的后端路由

1. 在`backend/app/api/v1/`创建新模块文件
2. 定义`router = APIRouter(prefix="/xxx", tags=["xxx"])`
3. 在`__init__.py`中注册:
   ```python
   api_router.include_router(your_module.router)
   ```

### 9.2 添加新的前端页面

1. 在`frontend/src/app/`创建新文件夹
2. 添加`page.tsx`文件
3. 更新导航组件(如需要)

---

## 10. 路由安全性

### 10.1 认证中间件

- Token存储: `localStorage.getItem('token')`
- 请求拦截: Axios interceptors
- 响应处理: 统一错误处理

### 10.2 权限控制

- 管理员路由: `/admin/*`
- 普通用户路由: `/projects/*`
- 公开路由: `/`, `/login`

---

## 附录: 快速参考

### 启动命令

```bash
# 后端
cd backend && uvicorn app.main:app --reload --port 8000

# 前端
cd frontend && npm run dev
```

### 环境变量

```env
# 后端 (.env)
DATABASE_URL=postgresql://user:pass@localhost:5432/web3_alpha_hunter
API_V1_PREFIX=/api/v1
CORS_ORIGINS=http://localhost:3000

# 前端 (.env.local)
NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
```

---

**文档维护**: 每次添加新路由时更新此文档
**最后更新**: 2025-10-14
