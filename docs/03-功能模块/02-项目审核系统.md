# 项目审核系统文档

> **功能状态**: ✅ 已完成
> **最后更新**: 2025-10-13
> **完成度**: 90%

---

## 📋 概述

项目审核系统是Web3 Alpha Hunter的核心质量控制模块，用于管理AI推荐的项目和KOL，确保平台数据的准确性和可靠性。

### 核心功能

1. ✅ AI自动项目发现
2. ✅ 项目审核队列管理
3. ✅ KOL审核队列管理
4. ✅ 审核工作流引擎
5. ✅ 前端审核页面

---

## 🗄️ 数据库设计

### 1. projects_pending (待审核项目表)

**用途**: 存储AI推荐的待审核项目

**字段** (24个):

```sql
CREATE TABLE projects_pending (
    id SERIAL PRIMARY KEY,

    -- 基础信息 (从AI提取)
    name VARCHAR(255) NOT NULL,
    symbol VARCHAR(50),
    blockchain VARCHAR(100),
    category VARCHAR(100),
    description TEXT,
    website VARCHAR(500),
    logo_url VARCHAR(500),

    -- 社交链接
    social_links JSONB,  -- {"twitter": "...", "telegram": "...", ...}

    -- AI评分 (自动生成)
    ai_score DECIMAL(5,2),  -- 0-100综合评分
    ai_grade VARCHAR(1),  -- S/A/B/C
    ai_confidence DECIMAL(5,2),  -- AI的置信度 0-100

    -- AI详细评分
    ai_team_score DECIMAL(5,2),
    ai_tech_score DECIMAL(5,2),
    ai_community_score DECIMAL(5,2),
    ai_tokenomics_score DECIMAL(5,2),
    ai_market_score DECIMAL(5,2),
    ai_risk_score DECIMAL(5,2),

    -- AI推荐信息
    ai_recommendation_reason TEXT,  -- AI推荐理由
    ai_extracted_info JSONB,  -- AI提取的结构化信息

    -- 来源信息
    source_url VARCHAR(500),  -- 发现来源URL
    source_content TEXT,  -- 来源内容快照

    -- 审核状态
    review_status VARCHAR(20) DEFAULT 'pending',  -- pending/approved/rejected
    reviewed_by INTEGER REFERENCES users(id),
    reviewed_at TIMESTAMP,
    rejection_reason TEXT,
    reject_reason TEXT,

    -- 时间戳
    submitted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_pending_status ON projects_pending(review_status);
CREATE INDEX idx_pending_score ON projects_pending(ai_score DESC);
CREATE INDEX idx_pending_submitted ON projects_pending(submitted_at DESC);
```

**当前数据**: 14条待审核项目

---

### 2. kols_pending (待审核KOL表)

详见 [KOL管理系统文档](./01-KOL管理系统.md#2-kols_pending-待审核kol)

---

## 🔄 审核工作流

### 项目审核流程

```
┌─────────────────┐
│   AI自动发现    │
│ (多源数据采集)  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  AI初步分析     │
│ - 提取信息      │
│ - 计算评分      │
│ - 生成推荐理由  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 写入pending表   │
│ status=pending  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  管理员审核     │
│ /review页面     │
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
    ▼         ▼
┌───────┐ ┌───────┐
│ 批准  │ │ 拒绝  │
└───┬───┘ └───┬───┘
    │         │
    ▼         ▼
┌───────┐ ┌───────────┐
│写入   │ │标记reason │
│projects│ │软删除     │
└───────┘ └───────────┘
```

---

## 📊 API接口

### 1. 获取待审核项目列表

```http
GET /api/v1/projects/pending
```

**权限**: 管理员

**查询参数**:
- `status` - 审核状态 (pending/approved/rejected)
- `min_score` - 最小AI评分
- `grade` - AI评级 (S/A/B/C)
- `sort_by` - 排序 (ai_score/submitted_at)
- `page`, `limit` - 分页

**响应示例**:
```json
{
  "success": true,
  "data": {
    "projects": [
      {
        "id": 1,
        "name": "New DeFi Protocol",
        "symbol": "NDP",
        "ai_score": 88.5,
        "ai_grade": "A",
        "ai_confidence": 82.0,
        "ai_recommendation_reason": "技术团队背景优秀，来自Uniswap核心开发；代币经济学设计合理；已获得顶级VC投资。",
        "source_url": "https://twitter.com/...",
        "submitted_at": "2025-10-12T10:30:00Z",
        "review_status": "pending"
      }
    ],
    "pagination": {
      "current_page": 1,
      "total_pages": 2,
      "total_items": 14
    }
  }
}
```

---

### 2. 获取待审核项目详情

```http
GET /api/v1/projects/pending/{project_id}
```

**权限**: 管理员

**响应**: 完整的项目信息 + AI分析结果 + 来源信息

---

### 3. 审核项目

```http
POST /api/v1/projects/pending/{project_id}/review
```

**权限**: 管理员

**请求体**:
```json
{
  "action": "approve",  // or "reject"
  "rejection_reason": "项目信息不完整"  // 拒绝时必填
}
```

**批准后的操作**:
1. 从 `projects_pending` 提取数据
2. 创建新的 `projects` 记录
3. 初始化 `social_metrics` 和 `onchain_metrics`
4. 更新 `projects_pending.review_status = 'approved'`
5. 记录审核人和审核时间

**拒绝后的操作**:
1. 更新 `projects_pending.review_status = 'rejected'`
2. 记录 `rejection_reason`
3. 记录审核人和审核时间
4. 数据保留但不显示在pending列表

---

### 4. 批量审核

```http
POST /api/v1/projects/pending/batch-review
```

**权限**: 管理员

**请求体**:
```json
{
  "project_ids": [1, 2, 3],
  "action": "approve",  // or "reject"
  "rejection_reason": "批量拒绝理由"
}
```

---

## 🎨 前端页面

### 审核页面 `/review`

**功能模块**:

#### 1. 待审核项目列表

**展示内容**:
- 项目卡片 (名称、Logo、评分、评级)
- AI推荐理由
- AI置信度
- 6维评分雷达图
- 来源链接
- 提交时间

**操作按钮**:
- ✅ 批准
- ❌ 拒绝
- 📝 查看详情
- 🔗 访问来源

#### 2. 筛选器

- 评级筛选 (S/A/B/C)
- 评分范围
- 提交时间范围
- 已审核/未审核切换

#### 3. 批量操作

- 全选/取消全选
- 批量批准
- 批量拒绝

#### 4. 审核详情模态框

**展示**:
- 完整项目信息
- AI分析详情
- 来源内容预览
- 拒绝理由输入框

---

## 🤖 AI推荐逻辑

### 1. 项目发现触发条件

**多源数据融合**:
- Twitter: KOL提及 + 话题热度
- Telegram: 官方频道公告
- CoinGecko: 新上线代币
- GitHub: 活跃开发项目
- Discord: 社区活跃度

**自动推荐阈值**:
```python
if (
    total_mentions >= 5 and  # 至少5个来源提及
    num_platforms >= 2 and   # 至少2个平台
    heat_score >= 60 and     # 热度分≥60
    (has_kol_mention or has_official_announcement)  # 有KOL或官方
):
    # 触发AI分析
    ai_analyze_and_recommend(project)
```

---

### 2. AI评分算法

**评分维度** (0-100):

```python
overall_score = (
    team_score * 0.20 +       # 团队背景
    tech_score * 0.25 +       # 技术创新
    community_score * 0.20 +  # 社区热度
    tokenomics_score * 0.15 + # 代币经济
    market_score * 0.10 +     # 市场时机
    (100 - risk_score) * 0.10 # 风险(逆向)
)
```

**评级标准**:
- **S级** (85-100): 强烈推荐，立即审核
- **A级** (70-84): 值得关注，优先审核
- **B级** (55-69): 有潜力，常规审核
- **C级** (<55): 风险较高，低优先级

---

### 3. AI推荐理由生成

**使用模型**: DeepSeek v3

**Prompt模板**:
```
分析以下Web3项目，生成推荐理由(100字以内):

项目名称: {name}
项目类别: {category}
来源: {source}
关键指标:
- Twitter粉丝: {twitter_followers}
- GitHub Stars: {github_stars}
- 提及次数: {mentions}

要求:
1. 突出核心亮点(团队/技术/投资)
2. 说明推荐依据
3. 简洁专业
```

**输出示例**:
> "技术团队来自Uniswap核心开发，具备顶级DeFi经验；已获得a16z领投$50M A轮融资；代币经济学设计合理，社区增长迅速(+15K/周)；已完成3轮安全审计。综合评分88分，强烈推荐关注。"

---

## 📊 审核统计

### 当前数据

| 状态 | 数量 | 占比 |
|------|------|------|
| 待审核 (pending) | 14 | 100% |
| 已批准 (approved) | 0 | 0% |
| 已拒绝 (rejected) | 0 | 0% |

### 审核效率指标

| 指标 | 目标值 | 当前值 |
|------|--------|--------|
| 平均审核时间 | <24小时 | - |
| 批准率 | 60-80% | - |
| AI准确率 | >70% | - |

---

## 🎯 审核规则

### 批准标准

**必须满足**:
✅ 项目真实存在
✅ 官网可访问
✅ 社交媒体账号活跃
✅ 基本信息完整

**加分项**:
- 顶级VC投资
- 知名团队背景
- 通过安全审计
- 社区活跃度高
- 代码开源且活跃

### 拒绝标准

**直接拒绝**:
❌ 疑似诈骗项目
❌ 信息严重不完整
❌ 社交媒体为僵尸粉
❌ 抄袭其他项目
❌ 团队完全匿名且无背书

**需人工判断**:
⚠️ 早期项目信息较少
⚠️ 团队部分匿名
⚠️ 未获得投资但技术创新
⚠️ 社区较小但增长快

---

## 🔍 审核最佳实践

### 审核checklist

**基础检查**:
- [ ] 项目名称无明显错误
- [ ] 官网链接有效
- [ ] Logo清晰可见
- [ ] 项目描述合理

**深度检查**:
- [ ] Twitter账号真实(非新建)
- [ ] GitHub代码活跃(最近30天有commit)
- [ ] Telegram/Discord社区真实讨论
- [ ] 白皮书/文档可访问

**风险检查**:
- [ ] 无"guaranteed returns"等高风险承诺
- [ ] 无明显庞氏特征
- [ ] 团队信息可追溯
- [ ] 代币分配合理

---

## 🚀 未来优化

### 高优先级
- [ ] AI置信度可视化
- [ ] 审核历史记录
- [ ] 审核员绩效统计

### 中优先级
- [ ] 自动化风险检测
- [ ] 相似项目对比
- [ ] 批量导入功能

### 低优先级
- [ ] 审核投票机制(多人审核)
- [ ] AI自动批准(高置信度)
- [ ] 审核SLA提醒

---

## 🛠️ 代码示例

### Python - 审核项目

```python
from app.models.pending_project import PendingProject
from app.models.project import Project
from sqlalchemy.orm import Session

async def approve_project(
    db: Session,
    pending_id: int,
    reviewer_id: int
) -> Project:
    """批准待审核项目"""

    # 1. 获取pending项目
    pending = db.query(PendingProject).filter(
        PendingProject.id == pending_id
    ).first()

    if not pending:
        raise HTTPException(404, "Project not found")

    # 2. 创建正式项目
    project = Project(
        name=pending.name,
        symbol=pending.symbol,
        blockchain=pending.blockchain,
        category=pending.category,
        description=pending.description,
        website=pending.website,
        logo_url=pending.logo_url,
        social_links=pending.social_links,
        overall_score=pending.ai_score,
        grade=pending.ai_grade,
        # ... 其他字段映射
    )

    db.add(project)

    # 3. 更新pending状态
    pending.review_status = 'approved'
    pending.reviewed_by = reviewer_id
    pending.reviewed_at = datetime.now()

    db.commit()
    db.refresh(project)

    return project
```

### TypeScript - 前端审核

```typescript
const reviewProject = async (
  projectId: number,
  action: 'approve' | 'reject',
  reason?: string
) => {
  try {
    const response = await fetch(
      `/api/v1/projects/pending/${projectId}/review`,
      {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({
          action,
          rejection_reason: reason
        })
      }
    );

    if (!response.ok) {
      throw new Error('审核失败');
    }

    const data = await response.json();
    toast.success(action === 'approve' ? '项目已批准' : '项目已拒绝');

    // 刷新列表
    await fetchPendingProjects();

  } catch (error) {
    toast.error('操作失败，请重试');
  }
}
```

---

**文档维护**: 技术团队
**最后更新**: 2025-10-13
**状态**: ✅ 系统核心功能完成，持续优化中
