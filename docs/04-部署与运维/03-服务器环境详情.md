# æœåŠ¡å™¨ç¯å¢ƒè¯¦æƒ…

> **æœ€åæ›´æ–°**: 2025-10-04
> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **æœåŠ¡å™¨IP**: 47.253.226.250

---

## ğŸ“Š æœåŠ¡å™¨æ¦‚è§ˆ

### åŸºæœ¬ä¿¡æ¯

| é¡¹ç›® | ä¿¡æ¯ |
|------|------|
| **äº‘æœåŠ¡å•†** | é˜¿é‡Œäº‘ (Alibaba Cloud) |
| **æœåŠ¡ç±»å‹** | ECS (Elastic Compute Service) |
| **æ“ä½œç³»ç»Ÿ** | Ubuntu 24.04.2 LTS (Noble Numbat) |
| **å†…æ ¸ç‰ˆæœ¬** | Linux 6.8.0-60-generic |
| **æ¶æ„** | x86_64 |

### ç¡¬ä»¶é…ç½®

| èµ„æº | é…ç½® |
|------|------|
| **CPU** | 2æ ¸ Intel Xeon Platinum (2çº¿ç¨‹/æ ¸) |
| **å†…å­˜** | 1.6 GB |
| **ç£ç›˜** | 40 GB (å·²ä½¿ç”¨ 15GB, 39%) |
| **ç½‘ç»œ** | IPv4: 172.22.48.20 (å†…ç½‘) |
| | IPv4: 47.253.226.250 (å…¬ç½‘) |

### å½“å‰çŠ¶æ€ (2025-10-04)

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| **ç³»ç»Ÿè´Ÿè½½** | 0.47 |
| **å†…å­˜ä½¿ç”¨** | 80% (1.4GB/1.6GB) âš ï¸ |
| **ç£ç›˜ä½¿ç”¨** | 37.1% (15GB/40GB) |
| **Swapä½¿ç”¨** | 0% |
| **è¿è¡Œè¿›ç¨‹** | 129ä¸ª |
| **ç™»å½•ç”¨æˆ·** | 0 |

âš ï¸ **æ³¨æ„**: å†…å­˜ä½¿ç”¨ç‡è¾ƒé«˜(80%),å»ºè®®ç›‘æ§æˆ–å‡çº§é…ç½®

---

## ğŸ”§ å·²å®‰è£…è½¯ä»¶

### æ ¸å¿ƒæœåŠ¡

| è½¯ä»¶ | ç‰ˆæœ¬ | çŠ¶æ€ |
|------|------|------|
| **Docker** | 28.3.2 (build 578ccf6) | âœ… å·²å®‰è£… |
| **Nginx** | - | âœ… è¿è¡Œä¸­ |
| **PostgreSQL** | - | â“ æœªæ£€æµ‹åˆ° |
| **Redis** | - | â“ æœªæ£€æµ‹åˆ° |
| **Python** | - | â“ æœªæ£€æµ‹åˆ° |

### Dockerå®¹å™¨çŠ¶æ€

```bash
# å½“å‰æ— è¿è¡Œä¸­çš„å®¹å™¨
docker ps
# NAMES     STATUS    PORTS
```

---

## ğŸ“ æ¨èç›®å½•ç»“æ„

### åº”ç”¨éƒ¨ç½²ç›®å½•

```bash
/app/
â””â”€â”€ web3-alpha-hunter/
    â”œâ”€â”€ backend/              # åç«¯åº”ç”¨
    â”œâ”€â”€ frontend/             # å‰ç«¯åº”ç”¨ (å¯é€‰)
    â”œâ”€â”€ data/                 # æ•°æ®æ–‡ä»¶
    â”‚   â”œâ”€â”€ postgresql/       # PostgreSQLæ•°æ®
    â”‚   â””â”€â”€ redis/            # Redisæ•°æ®
    â”œâ”€â”€ logs/                 # åº”ç”¨æ—¥å¿—
    â”‚   â”œâ”€â”€ backend/
    â”‚   â”œâ”€â”€ nginx/
    â”‚   â””â”€â”€ celery/
    â”œâ”€â”€ backups/              # æ•°æ®å¤‡ä»½
    â”‚   â””â”€â”€ postgresql/
    â”œâ”€â”€ ssl/                  # SSLè¯ä¹¦
    â”œâ”€â”€ docker-compose.yml    # Dockerç¼–æ’æ–‡ä»¶
    â””â”€â”€ .env                  # ç¯å¢ƒå˜é‡
```

### åˆ›å»ºç›®å½•å‘½ä»¤

```bash
ssh -i VPNKEY.pem root@47.253.226.250 << 'EOF'
  mkdir -p /app/web3-alpha-hunter/{backend,frontend,data/{postgresql,redis},logs/{backend,nginx,celery},backups/postgresql,ssl}
  chmod -R 755 /app/web3-alpha-hunter
  echo "ç›®å½•ç»“æ„åˆ›å»ºå®Œæˆ"
EOF
```

---

## ğŸ³ Docker Composeé…ç½®å»ºè®®

### æ¨èçš„docker-compose.yml

```yaml
version: '3.8'

services:
  # PostgreSQLæ•°æ®åº“
  postgres:
    image: postgres:15-alpine
    container_name: web3_postgres
    restart: always
    environment:
      POSTGRES_DB: web3_alpha_hunter
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - /app/web3-alpha-hunter/data/postgresql:/var/lib/postgresql/data
    ports:
      - "127.0.0.1:5432:5432"
    networks:
      - web3_network

  # Redisç¼“å­˜
  redis:
    image: redis:7-alpine
    container_name: web3_redis
    restart: always
    command: redis-server --appendonly yes
    volumes:
      - /app/web3-alpha-hunter/data/redis:/data
    ports:
      - "127.0.0.1:6379:6379"
    networks:
      - web3_network

  # åç«¯API
  backend:
    build: ./backend
    container_name: web3_backend
    restart: always
    environment:
      DATABASE_URL: postgresql://postgres:${DB_PASSWORD}@postgres:5432/web3_alpha_hunter
      REDIS_URL: redis://redis:6379
    volumes:
      - ./backend:/app
      - /app/web3-alpha-hunter/logs/backend:/app/logs
    ports:
      - "127.0.0.1:8000:8000"
    depends_on:
      - postgres
      - redis
    networks:
      - web3_network

  # Celery Worker
  celery_worker:
    build: ./backend
    container_name: web3_celery
    restart: always
    command: celery -A app.tasks.celery worker --loglevel=info
    environment:
      DATABASE_URL: postgresql://postgres:${DB_PASSWORD}@postgres:5432/web3_alpha_hunter
      REDIS_URL: redis://redis:6379
    volumes:
      - ./backend:/app
      - /app/web3-alpha-hunter/logs/celery:/app/logs
    depends_on:
      - postgres
      - redis
    networks:
      - web3_network

  # Nginxåå‘ä»£ç†
  nginx:
    image: nginx:alpine
    container_name: web3_nginx
    restart: always
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - /app/web3-alpha-hunter/ssl:/etc/nginx/ssl:ro
      - /app/web3-alpha-hunter/logs/nginx:/var/log/nginx
    depends_on:
      - backend
    networks:
      - web3_network

networks:
  web3_network:
    driver: bridge
```

---

## ğŸ”’ å®‰å…¨åŠ å›ºå»ºè®®

### 1. é˜²ç«å¢™é…ç½®

```bash
# å®‰è£…å¹¶é…ç½®ufw
ssh -i VPNKEY.pem root@47.253.226.250 << 'EOF'
  # å®‰è£…ufw
  apt update && apt install -y ufw

  # é»˜è®¤è§„åˆ™
  ufw default deny incoming
  ufw default allow outgoing

  # å…è®¸SSH (é‡è¦!)
  ufw allow 22/tcp

  # å…è®¸HTTP/HTTPS
  ufw allow 80/tcp
  ufw allow 443/tcp

  # å¯ç”¨é˜²ç«å¢™
  echo "y" | ufw enable

  # æŸ¥çœ‹çŠ¶æ€
  ufw status verbose
EOF
```

### 2. ç¦ç”¨å¯†ç ç™»å½•

```bash
ssh -i VPNKEY.pem root@47.253.226.250 << 'EOF'
  # å¤‡ä»½é…ç½®
  cp /etc/ssh/sshd_config /etc/ssh/sshd_config.bak

  # ä¿®æ”¹é…ç½®
  sed -i 's/#PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config
  sed -i 's/PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config

  # é‡å¯SSH
  systemctl restart sshd

  echo "å¯†ç ç™»å½•å·²ç¦ç”¨,ä»…å…è®¸å¯†é’¥ç™»å½•"
EOF
```

### 3. è‡ªåŠ¨å®‰å…¨æ›´æ–°

```bash
ssh -i VPNKEY.pem root@47.253.226.250 << 'EOF'
  # å®‰è£…è‡ªåŠ¨æ›´æ–°
  apt install -y unattended-upgrades

  # å¯ç”¨è‡ªåŠ¨æ›´æ–°
  dpkg-reconfigure -plow unattended-upgrades

  echo "è‡ªåŠ¨å®‰å…¨æ›´æ–°å·²å¯ç”¨"
EOF
```

---

## ğŸ“ˆ ç›‘æ§é…ç½®

### 1. å®‰è£…ç›‘æ§å·¥å…·

```bash
ssh -i VPNKEY.pem root@47.253.226.250 << 'EOF'
  # å®‰è£…htop (è¿›ç¨‹ç›‘æ§)
  apt install -y htop

  # å®‰è£…iotop (IOç›‘æ§)
  apt install -y iotop

  # å®‰è£…iftop (ç½‘ç»œç›‘æ§)
  apt install -y iftop

  # å®‰è£…netdata (å®æ—¶ç›‘æ§é¢æ¿)
  bash <(curl -Ss https://my-netdata.io/kickstart.sh) --dont-wait
EOF
```

### 2. Dockerç›‘æ§

```bash
# å®‰è£…ctop (Dockerå®¹å™¨ç›‘æ§)
ssh -i VPNKEY.pem root@47.253.226.250 << 'EOF'
  wget https://github.com/bcicen/ctop/releases/download/v0.7.7/ctop-0.7.7-linux-amd64 -O /usr/local/bin/ctop
  chmod +x /usr/local/bin/ctop
  echo "ctopå·²å®‰è£…,ä½¿ç”¨å‘½ä»¤: ctop"
EOF
```

---

## ğŸ”„ ç³»ç»Ÿç»´æŠ¤è„šæœ¬

### è‡ªåŠ¨å¤‡ä»½è„šæœ¬

åˆ›å»º `/app/web3-alpha-hunter/scripts/backup.sh`:

```bash
#!/bin/bash
# æ•°æ®åº“å¤‡ä»½è„šæœ¬

BACKUP_DIR="/app/web3-alpha-hunter/backups/postgresql"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="db_backup_${DATE}.sql.gz"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
docker-compose exec -T postgres pg_dump -U postgres web3_alpha_hunter | gzip > "${BACKUP_DIR}/${BACKUP_FILE}"

# ä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½
find $BACKUP_DIR -name "db_backup_*.sql.gz" -mtime +7 -delete

echo "å¤‡ä»½å®Œæˆ: ${BACKUP_FILE}"
```

### è®¾ç½®å®šæ—¶ä»»åŠ¡

```bash
ssh -i VPNKEY.pem root@47.253.226.250 << 'EOF'
  # æ·»åŠ åˆ°crontab
  (crontab -l 2>/dev/null; echo "0 2 * * * /app/web3-alpha-hunter/scripts/backup.sh >> /app/web3-alpha-hunter/logs/backup.log 2>&1") | crontab -

  echo "æ¯æ—¥å‡Œæ™¨2ç‚¹è‡ªåŠ¨å¤‡ä»½å·²è®¾ç½®"
EOF
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å†…å­˜ä¼˜åŒ–

**å½“å‰é—®é¢˜**: å†…å­˜ä½¿ç”¨ç‡80%,å¯ç”¨å†…å­˜ä»…200MB

**è§£å†³æ–¹æ¡ˆ**:
1. **å‡çº§æœåŠ¡å™¨é…ç½®** (æ¨è)
   - å»ºè®®å‡çº§åˆ°è‡³å°‘ 4GB å†…å­˜
   - å½“å‰1.6GBå¯¹äºè¿è¡Œå¤šä¸ªDockerå®¹å™¨åå°

2. **ä¼˜åŒ–Dockerå†…å­˜é™åˆ¶**
   ```yaml
   # åœ¨docker-compose.ymlä¸­é™åˆ¶å®¹å™¨å†…å­˜
   services:
     backend:
       mem_limit: 512m
       mem_reservation: 256m
   ```

3. **å¯ç”¨Swap** (ä¸´æ—¶æ–¹æ¡ˆ)
   ```bash
   ssh -i VPNKEY.pem root@47.253.226.250 << 'EOF'
     # åˆ›å»º2GB swap
     fallocate -l 2G /swapfile
     chmod 600 /swapfile
     mkswap /swapfile
     swapon /swapfile
     echo '/swapfile none swap sw 0 0' >> /etc/fstab
   EOF
   ```

### 2. ç£ç›˜ç©ºé—´ç›‘æ§

```bash
# è®¾ç½®ç£ç›˜ä½¿ç”¨å‘Šè­¦
ssh -i VPNKEY.pem root@47.253.226.250 << 'EOF'
  cat > /usr/local/bin/disk-alert.sh << 'SCRIPT'
#!/bin/bash
THRESHOLD=80
USAGE=$(df -h / | tail -1 | awk '{print $5}' | sed 's/%//')

if [ $USAGE -gt $THRESHOLD ]; then
  echo "è­¦å‘Š: ç£ç›˜ä½¿ç”¨ç‡ ${USAGE}% è¶…è¿‡é˜ˆå€¼ ${THRESHOLD}%"
  # è¿™é‡Œå¯ä»¥æ·»åŠ å‘é€é‚®ä»¶æˆ–å…¶ä»–é€šçŸ¥çš„ä»£ç 
fi
SCRIPT

  chmod +x /usr/local/bin/disk-alert.sh

  # æ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡
  (crontab -l 2>/dev/null; echo "0 * * * * /usr/local/bin/disk-alert.sh >> /var/log/disk-alert.log 2>&1") | crontab -
EOF
```

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²å‘½ä»¤

### ä¸€é”®éƒ¨ç½²è„šæœ¬

```bash
#!/bin/bash
# é¡¹ç›®éƒ¨ç½²è„šæœ¬

echo "å¼€å§‹éƒ¨ç½²Web3 Alpha Hunter..."

# 1. åˆ›å»ºç›®å½•ç»“æ„
ssh -i VPNKEY.pem root@47.253.226.250 "mkdir -p /app/web3-alpha-hunter/{backend,data,logs,backups}"

# 2. ä¸Šä¼ æ–‡ä»¶
rsync -avz -e "ssh -i VPNKEY.pem" \
  --exclude 'node_modules' \
  --exclude '__pycache__' \
  --exclude '.git' \
  ./docker-compose.yml \
  ./backend/ \
  root@47.253.226.250:/app/web3-alpha-hunter/

# 3. å¯åŠ¨æœåŠ¡
ssh -i VPNKEY.pem root@47.253.226.250 << 'EOF'
  cd /app/web3-alpha-hunter
  docker-compose up -d
  docker-compose ps
EOF

echo "éƒ¨ç½²å®Œæˆ!"
```

---

## ğŸ“‹ å¾…åŠæ¸…å•

### ç´§æ€¥ (éœ€ç«‹å³å¤„ç†)
- [ ] âš ï¸ **å‡çº§æœåŠ¡å™¨å†…å­˜** - å½“å‰1.6GBåå°,å»ºè®®å‡çº§åˆ°4GB
- [ ] ğŸ”’ **é…ç½®é˜²ç«å¢™** - é™åˆ¶ä¸å¿…è¦çš„ç«¯å£è®¿é—®
- [ ] ğŸ” **ç¦ç”¨å¯†ç ç™»å½•** - æé«˜SSHå®‰å…¨æ€§

### é‡è¦ (æœ¬å‘¨å®Œæˆ)
- [ ] ğŸ“¦ **éƒ¨ç½²åº”ç”¨** - ä½¿ç”¨Docker Composeéƒ¨ç½²
- [ ] ğŸ”„ **è®¾ç½®è‡ªåŠ¨å¤‡ä»½** - æ¯æ—¥å¤‡ä»½æ•°æ®åº“
- [ ] ğŸ“Š **å®‰è£…ç›‘æ§å·¥å…·** - Netdataæˆ–å…¶ä»–ç›‘æ§æ–¹æ¡ˆ
- [ ] ğŸŒ **é…ç½®åŸŸå** - å°†åŸŸåæŒ‡å‘æœåŠ¡å™¨IP

### ä¸€èˆ¬ (æœ¬æœˆå®Œæˆ)
- [ ] ğŸ“œ **é…ç½®SSLè¯ä¹¦** - Let's Encryptè‡ªåŠ¨ç»­æœŸ
- [ ] ğŸ”” **è®¾ç½®å‘Šè­¦** - ç£ç›˜/å†…å­˜/CPUå‘Šè­¦
- [ ] ğŸ“š **ç¼–å†™éƒ¨ç½²æ–‡æ¡£** - è¯¦ç»†çš„éƒ¨ç½²SOP
- [ ] ğŸ§ª **å‹åŠ›æµ‹è¯•** - éªŒè¯æœåŠ¡å™¨æ€§èƒ½

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [æœåŠ¡å™¨è¿æ¥æŒ‡å—](./02-æœåŠ¡å™¨è¿æ¥æŒ‡å—.md) - SSHè¿æ¥å’Œå¸¸ç”¨å‘½ä»¤
- [éƒ¨ç½²æŒ‡å—](./01-éƒ¨ç½²æŒ‡å—.md) - å®Œæ•´éƒ¨ç½²æµç¨‹
- [æ•°æ®åº“è®¾è®¡æ–‡æ¡£](../02-æŠ€æœ¯å®ç°/04-æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md) - æ•°æ®åº“é…ç½®

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### é˜¿é‡Œäº‘æ”¯æŒ
- **æ§åˆ¶å°**: https://ecs.console.aliyun.com
- **å·¥å•ç³»ç»Ÿ**: https://workorder.console.aliyun.com
- **æ–‡æ¡£ä¸­å¿ƒ**: https://help.aliyun.com

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-10-04
**æœåŠ¡å™¨æ£€æµ‹æ—¶é—´**: 2025-10-04 09:21:03 CST
