# ✅ 配置完成 - 下一步操作指南

**完成时间**: 2025-01-07  
**状态**: Telegram API已配置，需要首次授权

---

## 🎯 已完成配置

### ✅ Telegram API
```bash
TELEGRAM_API_ID=21480897
TELEGRAM_API_HASH=6100e61192b430089e66d047dc9d6bce
TELEGRAM_BOT_TOKEN=7999542138:AAHaBdI2pwrRUXdqRMv6dNw9BNONSa-FTCA
```

---

## 📋 还需完成的配置

### 1. Apify API (Twitter采集) - 必需

**注册地址**: https://apify.com/

**步骤**:
1. Sign Up 注册账号
2. 选择 **Starter套餐** ($49/月)
3. Dashboard → Settings → Integrations
4. 复制 "Personal API token"

**配置**:
```bash
# 在 backend/.env 文件中添加:
APIFY_API_KEY=apify_api_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

---

### 2. DeepSeek AI (AI分析) - 必需

**注册地址**: https://platform.deepseek.com/

**步骤**:
1. 注册账号
2. API Keys 页面
3. 创建新密钥
4. 复制密钥

**配置**:
```bash
# 在 backend/.env 文件中添加:
DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

---

### 3. Telegram首次授权 (一次性操作)

Telegram采集器需要首次授权才能工作。

**授权步骤**:

```bash
cd /Users/xinghailong/Documents/soft/faxianjihui/backend

# 运行授权脚本
python3 -c "
import asyncio
from telethon import TelegramClient

async def auth():
    client = TelegramClient('web3_alpha_hunter', 21480897, '6100e61192b430089e66d047dc9d6bce')
    await client.start()
    print('✅ 授权成功！')
    await client.disconnect()

asyncio.run(auth())
"
```

**授权流程**:
1. 输入您的手机号 (带国际区号，如: +86138xxxxxxxx)
2. 接收Telegram验证码
3. 输入验证码
4. (如果有两步验证) 输入密码
5. 完成！

**注意**: 
- 授权只需一次
- session文件会保存到 `backend/web3_alpha_hunter.session`
- 请勿删除该文件

---

## 🚀 配置完成后的操作

### 步骤1: 安装依赖

```bash
cd /Users/xinghailong/Documents/soft/faxianjihui/backend
pip install -r requirements.txt
```

### 步骤2: 重启Celery服务

```bash
cd /Users/xinghailong/Documents/soft/faxianjihui
./stop-celery.sh
./start-celery.sh
```

### 步骤3: 查看采集日志

```bash
tail -f /tmp/celery-worker.log

# 应该看到:
# ✅ Apify Twitter collector initialized
# ✅ Telegram client initialized
# 📡 Using Apify Twitter collector
# 🔍 Starting Apify Twitter collection...
```

---

## 🧪 测试采集功能

### 测试Telegram采集

```bash
cd backend
python3 -c "
import asyncio
from app.services.collectors.telegram import telegram_collector

async def test():
    await telegram_collector.start_client()
    messages = await telegram_collector.get_channel_messages('@cryptonewsflash', limit=10)
    print(f'✅ 采集到 {len(messages)} 条消息')
    for m in messages[:3]:
        print(f'  - {m.get(\"text\", \"\")[:60]}...')

asyncio.run(test())
"
```

### 测试Twitter采集 (需要先配置Apify)

```bash
python3 -c "
from app.services.collectors.twitter_apify import twitter_apify_collector
projects = twitter_apify_collector.collect_and_extract(hours=24)
print(f'✅ 采集到 {len(projects)} 个项目')
for p in projects[:5]:
    print(f'  - {p.get(\"name\")}: {p.get(\"description\")[:60]}...')
"
```

---

## 📊 完整配置示例

最终的 `backend/.env` 文件应该包含:

```bash
# ==================== AI服务 ====================
DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# ==================== Twitter采集 (Apify) ====================
APIFY_API_KEY=apify_api_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
APIFY_TWITTER_ACTOR_ID=apify/twitter-scraper

# ==================== Telegram API ====================
TELEGRAM_API_ID=21480897
TELEGRAM_API_HASH=6100e61192b430089e66d047dc9d6bce
TELEGRAM_BOT_TOKEN=7999542138:AAHaBdI2pwrRUXdqRMv6dNw9BNONSa-FTCA

# ==================== 数据库 ====================
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/web3_alpha_hunter

# ==================== Redis & Celery ====================
REDIS_URL=redis://localhost:6379/0
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/1
```

---

## ✅ 完成标准

配置完成后，您应该能看到:

- [ ] Telegram授权成功，生成session文件
- [ ] Apify API Key已配置
- [ ] DeepSeek API Key已配置
- [ ] Celery Worker正常启动
- [ ] 采集任务每15分钟自动执行
- [ ] 管理面板显示采集统计数据

---

## 🎯 预期效果

### 数据采集量 (配置完成后)

| 平台 | 频率 | 每日数据量 |
|------|------|------------|
| **Twitter** | 15分钟 | 4,800-19,200条 |
| **Telegram** | 15分钟 | 2,880-9,600条 |
| **CoinGecko** | 30分钟 | 960-1,440项目 |

### 成本

| 服务 | 月成本 |
|------|--------|
| Apify | $49 |
| Telegram | $0 |
| DeepSeek | $7-21 |
| **总计** | **$56-70** |

---

## 📚 相关文档

- [第三方采集服务配置指南](./第三方采集服务配置指南.md)
- [Telegram配置说明](./Telegram配置说明.md)
- [实施完成总结](./实施完成总结.md)

---

## 🆘 遇到问题？

### 问题1: Telegram授权失败

**解决**: 
1. 确认手机号格式正确（+86xxxxxxxx）
2. 检查网络连接
3. 删除旧session: `rm backend/web3_alpha_hunter.session`
4. 重新授权

### 问题2: Celery启动报错

**解决**:
```bash
# 检查Python环境
cd backend
pip install -r requirements.txt

# 检查.env文件
cat .env | grep -E "TELEGRAM|APIFY|DEEPSEEK"
```

### 问题3: 采集无数据

**解决**:
1. 检查API配额是否用完
2. 查看Celery日志: `tail -100 /tmp/celery-worker.log`
3. 手动触发采集测试

---

**下一步**: 注册Apify和DeepSeek，完成配置后即可开始自动采集！ 🚀
