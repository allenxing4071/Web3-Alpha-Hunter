# 🔐 角色管理系统说明

## 📋 系统概述

已为Web3 Alpha Hunter添加完整的角色管理系统,提升安全性和权限控制。

## 👥 角色类型

### 1. 管理员 (admin)
- **权限**: 完全访问
- **可访问页面**:
  - ✅ 所有普通用户页面
  - ✅ 控制面板 (/dashboard)
  - ✅ 系统管理 (/admin)
  - ✅ 用户管理 (/users)
  - ✅ 所有机密文档和配置

### 2. 普通用户 (user)
- **权限**: 受限访问
- **可访问页面**:
  - ✅ 首页
  - ✅ 项目列表
  - ✅ 项目对比
  - ✅ 公共API文档
- **不可访问**:
  - ❌ 控制面板
  - ❌ 系统管理
  - ❌ 用户管理
  - ❌ 机密文档

## 🔒 安全增强

### 1. Dashboard保护
- **原位置**: `frontend/public/dashboard.html` (任何人可访问)
- **新位置**: `frontend/src/app/dashboard/page.tsx` (需登录+管理员权限)
- **保护方式**: 
  - 登录验证
  - 管理员角色验证
  - 路由守卫

### 2. 权限检查点
```typescript
// 检查是否登录
if (!isAuthenticated) {
  router.push('/login')
  return
}

// 检查是否为管理员
if (!isAdmin()) {
  router.push('/')
  return
}
```

### 3. 导航栏自适应
- 管理员: 显示所有菜单项(带🔒标识)
- 普通用户: 只显示允许访问的菜单项

## 📝 默认账户

### 管理员账户
```
用户名: admin
密码: admin123
角色: 管理员
邮箱: admin@web3hunter.com
```

⚠️ **生产环境必须修改默认密码!**

## 🎯 使用流程

### 1. 管理员登录
```
1. 访问 http://localhost:3000/login
2. 输入 admin / admin123
3. 登录后可访问所有功能
```

### 2. 添加新用户
```
1. 管理员登录
2. 访问"用户管理"页面
3. 点击"添加用户"
4. 填写信息并选择角色
5. 提交保存
```

### 3. 修改用户角色
```
1. 在用户管理页面找到目标用户
2. 点击"编辑"
3. 修改角色为"管理员"或"普通用户"
4. 保存更改
```

## 🛡️ 安全规则

### 不可删除项目
1. ❌ 管理员用户
2. ❌ 系统中唯一用户
3. ❌ 当前登录用户

### 权限继承
- 管理员可以创建其他管理员
- 管理员可以修改任何用户的角色
- 普通用户无法访问用户管理

## 🔧 技术实现

### 1. 数据结构
```typescript
interface User {
  id: string
  username: string
  email: string
  role: 'admin' | 'user'  // 角色字段
  createdAt: string
}
```

### 2. 状态管理
- **userStore**: 用户数据(包含角色)
- **authStore**: 认证状态(包含isAdmin方法)
- **localStorage**: 持久化存储

### 3. 路由保护
```typescript
// 页面级保护
useEffect(() => {
  if (!isAuthenticated) {
    router.push('/login')
  }
  if (!isAdmin()) {
    router.push('/')
  }
}, [isAuthenticated, isAdmin])
```

### 4. UI自适应
```typescript
// 导航栏
{isAdmin() && (
  <Link href="/admin">系统管理 🔒</Link>
)}

// 功能按钮
{isAdmin() ? (
  <button>编辑</button>
) : (
  <button disabled>无权限</button>
)}
```

## 📊 权限对比表

| 功能 | 管理员 | 普通用户 |
|------|--------|---------|
| 查看项目列表 | ✅ | ✅ |
| 项目对比 | ✅ | ✅ |
| 控制面板 | ✅ | ❌ |
| 系统管理 | ✅ | ❌ |
| 用户管理 | ✅ | ❌ |
| 数据采集 | ✅ | ❌ |
| 查看配置文档 | ✅ | ❌ |
| 查看API密钥 | ✅ | ❌ |
| 执行系统命令 | ✅ | ❌ |

## 🚀 访问地址

### 公开页面
- 登录: http://localhost:3000/login
- 首页: http://localhost:3000
- 项目列表: http://localhost:3000/projects

### 管理员专属 (需登录+管理员角色)
- 控制面板: http://localhost:3000/dashboard
- 系统管理: http://localhost:3000/admin
- 用户管理: http://localhost:3000/users

## 🔐 安全建议

### 1. 生产环境必做
- [ ] 修改默认管理员密码
- [ ] 使用强密码策略
- [ ] 定期轮换密码
- [ ] 启用HTTPS
- [ ] 配置防火墙规则

### 2. 权限管理
- [ ] 最小权限原则
- [ ] 定期审查用户权限
- [ ] 记录敏感操作日志
- [ ] 设置会话超时

### 3. 数据保护
- [ ] 加密敏感数据
- [ ] 定期备份用户数据
- [ ] 使用环境变量存储密钥
- [ ] 不提交.env文件到Git

## 🆘 常见问题

### Q1: 忘记管理员密码?
```bash
# 重置localStorage
浏览器访问: http://localhost:3000/reset-login.html
或控制台执行:
localStorage.clear()
location.reload()
```

### Q2: 如何创建第二个管理员?
```
1. 以管理员身份登录
2. 访问用户管理
3. 添加新用户时选择"管理员"角色
```

### Q3: 普通用户能看到管理员功能吗?
```
不能。管理员专属页面和功能对普通用户完全隐藏。
尝试直接访问会被重定向到首页。
```

### Q4: 如何验证角色系统工作?
```
1. 创建一个普通用户
2. 登出管理员
3. 用普通用户登录
4. 确认无法访问 /dashboard, /admin, /users
```

## 📈 后续增强建议

### 1. 功能增强
- [ ] 密码重置功能
- [ ] 邮箱验证
- [ ] 双因素认证(2FA)
- [ ] 登录日志记录

### 2. 角色细化
- [ ] 添加"只读"角色
- [ ] 添加"分析师"角色
- [ ] 自定义权限组合

### 3. 安全加固
- [ ] 密码加密存储
- [ ] JWT Token认证
- [ ] API密钥管理
- [ ] IP白名单

---

**当前状态**: 角色管理系统已完成并启用 ✅
**安全级别**: 基础权限控制已实现 🔒
**建议**: 生产环境部署前务必修改默认密码 ⚠️
