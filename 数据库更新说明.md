# ğŸ’¾ æ•°æ®åº“æ›´æ–°è¯´æ˜

## ğŸ“… æ›´æ–°ä¿¡æ¯

**æ›´æ–°æ—¶é—´**: 2025-10-05  
**æ›´æ–°ç‰ˆæœ¬**: v1.1  
**è¿ç§»è„šæœ¬**: `003_add_prediction_tables.py`

---

## ğŸ†• æ–°å¢è¡¨ç»“æ„

### 1. token_launch_predictions (ä»£å¸å‘å¸æ¦‚ç‡é¢„æµ‹è¡¨)

**ç”¨é€”**: å­˜å‚¨é¡¹ç›®å‘å¸æ¦‚ç‡é¢„æµ‹ç»“æœ

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | INTEGER | ä¸»é”® |
| project_id | INTEGER | é¡¹ç›®IDï¼ˆå¤–é”®ï¼‰ |
| launch_probability | INTEGER | å‘å¸æ¦‚ç‡ (0-100%) |
| confidence | VARCHAR(20) | ç½®ä¿¡åº¦ (Very Low/Low/Medium/High/Very High) |
| estimated_timeline | VARCHAR(100) | é¢„ä¼°æ—¶é—´çº¿ ("1-2ä¸ªæœˆå†…"ç­‰) |
| detected_signals | JSON | æ£€æµ‹åˆ°çš„ä¿¡å·åˆ—è¡¨ |
| signal_count | INTEGER | ä¿¡å·æ•°é‡ |
| has_snapshot_announced | INTEGER | æ˜¯å¦å®£å¸ƒå¿«ç…§ (0/1) |
| has_tokenomics_published | INTEGER | æ˜¯å¦å…¬å¸ƒä»£å¸ç»æµ (0/1) |
| has_points_system | INTEGER | æ˜¯å¦æœ‰ç§¯åˆ†ç³»ç»Ÿ (0/1) |
| has_audit_completed | INTEGER | æ˜¯å¦å®Œæˆå®¡è®¡ (0/1) |
| has_mainnet_live | INTEGER | ä¸»ç½‘æ˜¯å¦ä¸Šçº¿ (0/1) |
| has_roadmap_token_mention | INTEGER | è·¯çº¿å›¾æ˜¯å¦æåŠä»£å¸ (0/1) |
| predicted_at | TIMESTAMP | é¢„æµ‹æ—¶é—´ |
| updated_at | TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**:
- `idx_prediction_project`: (project_id, predicted_at)
- `idx_prediction_probability`: (launch_probability)

**ç¤ºä¾‹æ•°æ®**:
```json
{
  "project_id": 1,
  "launch_probability": 65,
  "confidence": "High",
  "estimated_timeline": "2-4ä¸ªæœˆå†…",
  "detected_signals": [
    "å·²å®£å¸ƒå¿«ç…§æ—¶é—´",
    "ä»£å¸ç»æµå­¦å·²å…¬å¼€",
    "ä¸»ç½‘å·²ä¸Šçº¿",
    "å®Œæˆ$30Mèèµ„"
  ],
  "signal_count": 4
}
```

---

### 2. airdrop_value_estimates (ç©ºæŠ•ä»·å€¼ä¼°ç®—è¡¨)

**ç”¨é€”**: å­˜å‚¨ç©ºæŠ•ä»·å€¼ä¼°ç®—ç»“æœ

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | INTEGER | ä¸»é”® |
| project_id | INTEGER | é¡¹ç›®IDï¼ˆå¤–é”®ï¼‰ |
| estimated_value_usd | INTEGER | é¢„ä¼°ä»·å€¼(ç¾å…ƒ) |
| estimated_value_cny | INTEGER | é¢„ä¼°ä»·å€¼(äººæ°‘å¸) |
| min_value_usd | INTEGER | æœ€å°ä»·å€¼(ç¾å…ƒ) |
| max_value_usd | INTEGER | æœ€å¤§ä»·å€¼(ç¾å…ƒ) |
| confidence | VARCHAR(20) | ç½®ä¿¡åº¦ |
| reference_category | VARCHAR(50) | å‚è€ƒç±»åˆ« (DeFi/Layer2/NFT) |
| historical_avg | INTEGER | å†å²å¹³å‡å€¼ |
| tvl_adjustment | DECIMAL(5,2) | TVLè°ƒæ•´ç³»æ•° |
| funding_adjustment | DECIMAL(5,2) | èèµ„è°ƒæ•´ç³»æ•° |
| final_adjustment | DECIMAL(5,2) | æœ€ç»ˆè°ƒæ•´ç³»æ•° |
| estimated_at | TIMESTAMP | ä¼°ç®—æ—¶é—´ |
| updated_at | TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**:
- `idx_estimate_project`: (project_id, estimated_at)
- `idx_estimate_value`: (estimated_value_usd)

**ç¤ºä¾‹æ•°æ®**:
```json
{
  "project_id": 1,
  "estimated_value_usd": 3599,
  "estimated_value_cny": 23394,
  "min_value_usd": 1799,
  "max_value_usd": 7198,
  "confidence": "Medium",
  "reference_category": "Layer2",
  "tvl_adjustment": 1.5,
  "funding_adjustment": 1.4
}
```

---

### 3. investment_action_plans (æŠ•èµ„è¡ŒåŠ¨è®¡åˆ’è¡¨)

**ç”¨é€”**: å­˜å‚¨å®Œæ•´çš„æŠ•èµ„è¡ŒåŠ¨è®¡åˆ’

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | INTEGER | ä¸»é”® |
| project_id | INTEGER | é¡¹ç›®IDï¼ˆå¤–é”®ï¼‰ |
| project_tier | VARCHAR(1) | é¡¹ç›®åˆ†çº§ (S/A/B/C) |
| composite_score | INTEGER | ç»¼åˆè¯„åˆ† |
| total_budget | INTEGER | æ€»é¢„ç®—(äººæ°‘å¸) |
| budget_breakdown | JSON | é¢„ç®—æ˜ç»† |
| start_date | VARCHAR(20) | å¼€å§‹æ—¥æœŸ |
| target_duration | VARCHAR(50) | é¢„ä¼°å‘¨æœŸ |
| urgency | VARCHAR(20) | ç´§è¿«æ€§ (Normal/High/Critical) |
| expected_roi | VARCHAR(20) | é¢„æœŸROI ("10.0å€") |
| airdrop_estimate | INTEGER | é¢„ä¼°ç©ºæŠ•(ç¾å…ƒ) |
| action_steps | JSON | è¡ŒåŠ¨æ­¥éª¤åˆ—è¡¨ |
| total_steps | INTEGER | æ€»æ­¥éª¤æ•° |
| monitoring_metrics | JSON | ç›‘æ§æŒ‡æ ‡ |
| alert_conditions | JSON | é¢„è­¦æ¡ä»¶ |
| risks | JSON | é£é™©æç¤º |
| stop_loss_conditions | JSON | æ­¢æŸæ¡ä»¶ |
| status | VARCHAR(20) | çŠ¶æ€ (active/completed/cancelled) |
| completion_percentage | INTEGER | å®Œæˆåº¦ (0-100%) |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**:
- `idx_plan_project`: (project_id, created_at)
- `idx_plan_status`: (status, project_tier)

**ç¤ºä¾‹æ•°æ®**:
```json
{
  "project_id": 1,
  "project_tier": "S",
  "composite_score": 85,
  "total_budget": 2828,
  "budget_breakdown": {
    "æ¡¥æ¥èµ„äº§": {"é‡‘é¢": 1414, "è¯´æ˜": "æ¡¥æ¥åˆ°L2çš„ä¸»è¦èµ„é‡‘"},
    "Dappäº¤äº’": {"é‡‘é¢": 565, "è¯´æ˜": "åœ¨å„Dappä¸Šçš„æ“ä½œèµ„é‡‘"},
    "Gasè´¹": {"é‡‘é¢": 282, "è¯´æ˜": "L1+L2çš„Gasè´¹"},
    "åº”æ€¥å‚¨å¤‡": {"é‡‘é¢": 565, "è¯´æ˜": "çµæ´»åº”å¯¹"}
  },
  "expected_roi": "11.0å€",
  "action_steps": [
    {
      "step_number": 1,
      "action": "åˆ›å»ºæ–°é’±åŒ…æˆ–å‡†å¤‡ä¸“ç”¨é’±åŒ…",
      "deadline": "ç«‹å³",
      "cost_estimate": "Â¥0",
      "priority": "high"
    }
  ],
  "status": "active"
}
```

---

### 4. project_discoveries (é¡¹ç›®å‘ç°è®°å½•è¡¨)

**ç”¨é€”**: å­˜å‚¨é¡¹ç›®å‘ç°å’Œçƒ­åº¦è¿½è¸ªæ•°æ®

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | INTEGER | ä¸»é”® |
| project_name | VARCHAR(255) | é¡¹ç›®åç§° |
| total_mentions | INTEGER | æ€»æåŠæ¬¡æ•° |
| platform_mentions | JSON | å„å¹³å°æåŠæ•° |
| num_platforms | INTEGER | è¦†ç›–å¹³å°æ•° |
| signal_strength | INTEGER | ä¿¡å·å¼ºåº¦ (0-100) |
| first_discovered_at | TIMESTAMP | é¦–æ¬¡å‘ç°æ—¶é—´ |
| last_mentioned_at | TIMESTAMP | æœ€åæåŠæ—¶é—´ |
| heat_score | INTEGER | çƒ­åº¦åˆ† (0-100) |
| mentions_24h | INTEGER | 24å°æ—¶æåŠæ•° |
| mentions_7d | INTEGER | 7å¤©æåŠæ•° |
| growth_rate | DECIMAL(5,2) | å¢é•¿ç‡ |
| is_trending | INTEGER | æ˜¯å¦çƒ­é—¨ (0/1) |
| is_surge | INTEGER | æ˜¯å¦çªå‘ (0/1) |
| surge_ratio | DECIMAL(5,2) | çªå‘æ¯”ç‡ |
| has_token | INTEGER | æ˜¯å¦å·²å‘å¸ (0/1) |
| mention_samples | JSON | æåŠæ ·æœ¬ |
| discovery_status | VARCHAR(20) | å‘ç°çŠ¶æ€ (new/verified/false_positive) |
| discovered_at | TIMESTAMP | å‘ç°æ—¶é—´ |
| updated_at | TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**:
- `idx_discovery_project_name`: (project_name)
- `idx_discovery_discovered_at`: (discovered_at)
- `idx_discovery_signal`: (signal_strength, discovered_at)
- `idx_discovery_heat`: (heat_score, is_trending)

**ç¤ºä¾‹æ•°æ®**:
```json
{
  "project_name": "ZkFlow Protocol",
  "total_mentions": 15,
  "platform_mentions": {
    "twitter": 8,
    "telegram": 5,
    "medium": 2
  },
  "num_platforms": 3,
  "signal_strength": 85,
  "heat_score": 78,
  "is_trending": 1,
  "discovery_status": "verified"
}
```

---

## ğŸ“Š æ•°æ®åº“æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     projects        â”‚  ä¸»è¡¨
â”‚  (ç°æœ‰8ä¸ªé¡¹ç›®)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                     â”‚
           â–¼                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ token_launch_        â”‚            â”‚ airdrop_value_         â”‚
â”‚ predictions          â”‚            â”‚ estimates              â”‚
â”‚ (å‘å¸æ¦‚ç‡é¢„æµ‹)        â”‚            â”‚ (ç©ºæŠ•ä»·å€¼ä¼°ç®—)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ investment_action_   â”‚            â”‚ project_               â”‚
â”‚ plans                â”‚            â”‚ discoveries            â”‚
â”‚ (æŠ•èµ„è¡ŒåŠ¨è®¡åˆ’)        â”‚            â”‚ (é¡¹ç›®å‘ç°è®°å½•)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ æ•°æ®åº“è¿ç§»æ­¥éª¤

### 1. å¤‡ä»½ç°æœ‰æ•°æ®åº“
```bash
# PostgreSQLå¤‡ä»½
pg_dump -U postgres -d web3_alpha_hunter > backup_$(date +%Y%m%d).sql
```

### 2. è¿è¡Œè¿ç§»
```bash
cd backend
alembic upgrade head
```

### 3. éªŒè¯è¿ç§»
```bash
# æ£€æŸ¥è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸ
psql -U postgres -d web3_alpha_hunter -c "\dt"

# æ£€æŸ¥æ¯å¼ è¡¨çš„ç»“æ„
psql -U postgres -d web3_alpha_hunter -c "\d token_launch_predictions"
psql -U postgres -d web3_alpha_hunter -c "\d airdrop_value_estimates"
psql -U postgres -d web3_alpha_hunter -c "\d investment_action_plans"
psql -U postgres -d web3_alpha_hunter -c "\d project_discoveries"
```

### 4. å›æ»šï¼ˆå¦‚æœéœ€è¦ï¼‰
```bash
alembic downgrade -1
```

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### ä¿å­˜å‘å¸æ¦‚ç‡é¢„æµ‹
```python
from app.models import TokenLaunchPrediction
from app.db import SessionLocal

db = SessionLocal()

prediction = TokenLaunchPrediction(
    project_id=1,
    launch_probability=65,
    confidence="High",
    estimated_timeline="2-4ä¸ªæœˆå†…",
    detected_signals=["å·²å®£å¸ƒå¿«ç…§æ—¶é—´", "ä»£å¸ç»æµå­¦å·²å…¬å¼€"],
    signal_count=2,
    has_snapshot_announced=1,
    has_tokenomics_published=1
)

db.add(prediction)
db.commit()
```

### æŸ¥è¯¢é¡¹ç›®çš„è¡ŒåŠ¨è®¡åˆ’
```python
from app.models import InvestmentActionPlan

plans = db.query(InvestmentActionPlan)\
    .filter(InvestmentActionPlan.project_id == 1)\
    .filter(InvestmentActionPlan.status == "active")\
    .order_by(InvestmentActionPlan.created_at.desc())\
    .all()
```

### æŸ¥è¯¢çƒ­é—¨é¡¹ç›®å‘ç°
```python
from app.models import ProjectDiscovery

trending = db.query(ProjectDiscovery)\
    .filter(ProjectDiscovery.is_trending == 1)\
    .filter(ProjectDiscovery.has_token == 0)\
    .order_by(ProjectDiscovery.heat_score.desc())\
    .limit(10)\
    .all()
```

---

## ğŸ“ˆ æ•°æ®ç»Ÿè®¡

### å½“å‰æ•°æ®åº“è§„æ¨¡

| è¡¨å | è®°å½•æ•° | è¯´æ˜ |
|------|--------|------|
| projects | 8 | ç°æœ‰é¡¹ç›® |
| social_metrics | 15 | ç¤¾äº¤åª’ä½“æŒ‡æ ‡ |
| onchain_metrics | 0 | é“¾ä¸Šæ•°æ® |
| ai_analysis | 0 | AIåˆ†æ |
| **token_launch_predictions** | **0** | **æ–°å¢** |
| **airdrop_value_estimates** | **0** | **æ–°å¢** |
| **investment_action_plans** | **0** | **æ–°å¢** |
| **project_discoveries** | **0** | **æ–°å¢** |

### é¢„è®¡æ•°æ®å¢é•¿

**æ¯æ—¥æ–°å¢**:
- é¡¹ç›®å‘ç°: 10-20æ¡
- å‘å¸é¢„æµ‹: 5-10æ¡
- ç©ºæŠ•ä¼°ç®—: 5-10æ¡
- è¡ŒåŠ¨è®¡åˆ’: 2-5æ¡

**æ¯æœˆæ•°æ®é‡**:
- é¡¹ç›®å‘ç°: ~450æ¡
- å…¶ä»–è¡¨: ~200æ¡

---

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–

### å·²æ·»åŠ ç´¢å¼•

1. **å¤åˆç´¢å¼•**: æå‡å¤šæ¡ä»¶æŸ¥è¯¢æ€§èƒ½
   - `(project_id, created_at)` - æŒ‰é¡¹ç›®æŸ¥è¯¢å†å²
   - `(status, project_tier)` - æŒ‰çŠ¶æ€å’Œåˆ†çº§ç­›é€‰

2. **å•åˆ—ç´¢å¼•**: ä¼˜åŒ–å¸¸ç”¨æŸ¥è¯¢
   - `launch_probability` - æŒ‰æ¦‚ç‡æ’åº
   - `heat_score` - æŒ‰çƒ­åº¦æ’åº
   - `signal_strength` - æŒ‰ä¿¡å·å¼ºåº¦ç­›é€‰

3. **æ—¶é—´æˆ³ç´¢å¼•**: æ”¯æŒæ—¶é—´èŒƒå›´æŸ¥è¯¢
   - `discovered_at`, `predicted_at`, `estimated_at`

### æŸ¥è¯¢ä¼˜åŒ–å»ºè®®

```sql
-- âœ… å¥½çš„æŸ¥è¯¢ï¼ˆä½¿ç”¨ç´¢å¼•ï¼‰
SELECT * FROM token_launch_predictions 
WHERE project_id = 1 
ORDER BY predicted_at DESC 
LIMIT 10;

-- âœ… å¥½çš„æŸ¥è¯¢ï¼ˆä½¿ç”¨ç´¢å¼•ï¼‰
SELECT * FROM project_discoveries 
WHERE heat_score > 70 AND is_trending = 1
ORDER BY discovered_at DESC;

-- âŒ é¿å…å…¨è¡¨æ‰«æ
SELECT * FROM investment_action_plans 
WHERE action_steps::text LIKE '%é’±åŒ…%';
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. JSONå­—æ®µä½¿ç”¨
- PostgreSQLçš„JSONç±»å‹æ”¯æŒé«˜æ•ˆæŸ¥è¯¢
- å¯ä»¥ä½¿ç”¨`->`å’Œ`->>`æ“ä½œç¬¦æå–JSONå­—æ®µ
- ç¤ºä¾‹: `SELECT action_steps->'0'->>'action' FROM investment_action_plans`

### 2. æ—¶é—´æˆ³å­—æ®µ
- æ‰€æœ‰æ—¶é—´æˆ³ä½¿ç”¨UTCæ—¶åŒº
- è‡ªåŠ¨è®¾ç½®`created_at`å’Œ`updated_at`
- ä½¿ç”¨`server_default=func.now()`

### 3. å¤–é”®å…³è”
- `project_id`å…³è”åˆ°`projects.id`
- åˆ é™¤é¡¹ç›®æ—¶éœ€è¦å…ˆå¤„ç†å…³è”æ•°æ®
- å»ºè®®ä½¿ç”¨è½¯åˆ é™¤ï¼ˆçŠ¶æ€æ ‡è®°ï¼‰

### 4. æ•°æ®æ¸…ç†
```sql
-- æ¸…ç†30å¤©å‰çš„å‘ç°è®°å½•
DELETE FROM project_discoveries 
WHERE discovered_at < NOW() - INTERVAL '30 days' 
AND discovery_status = 'false_positive';

-- å½’æ¡£å·²å®Œæˆçš„è¡ŒåŠ¨è®¡åˆ’
UPDATE investment_action_plans 
SET status = 'archived' 
WHERE status = 'completed' 
AND updated_at < NOW() - INTERVAL '90 days';
```

---

## ğŸ”„ ä¸‹ä¸€æ­¥è®¡åˆ’

### è¿‘æœŸ
- [ ] æ›´æ–°APIæ¥å£ä¿å­˜æ–°æ•°æ®
- [ ] å‰ç«¯å±•ç¤ºå‘å¸é¢„æµ‹å’Œç©ºæŠ•ä¼°ç®—
- [ ] æ·»åŠ è¡ŒåŠ¨è®¡åˆ’æ‰§è¡Œè¿½è¸ª

### ä¸­æœŸ
- [ ] æ·»åŠ æ•°æ®åˆ†æè§†å›¾
- [ ] å®ç°æ•°æ®å¯¼å‡ºåŠŸèƒ½
- [ ] ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

### é•¿æœŸ
- [ ] æ•°æ®ä»“åº“å»ºè®¾
- [ ] å®æ—¶æ•°æ®åŒæ­¥
- [ ] æœºå™¨å­¦ä¹ æ¨¡å‹è®­ç»ƒ

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

**æ•°æ®åº“è¿ç§»é—®é¢˜**:
- æŸ¥çœ‹è¿ç§»æ—¥å¿—: `alembic history`
- å½“å‰ç‰ˆæœ¬: `alembic current`
- å›æ»š: `alembic downgrade -1`

**æ€§èƒ½é—®é¢˜**:
- æ£€æŸ¥æ…¢æŸ¥è¯¢: å¯ç”¨PostgreSQLæ…¢æŸ¥è¯¢æ—¥å¿—
- åˆ†ææŸ¥è¯¢è®¡åˆ’: `EXPLAIN ANALYZE <query>`
- é‡å»ºç´¢å¼•: `REINDEX TABLE <table_name>`

---

**æ›´æ–°å®Œæˆ**: 2025-10-05  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æ•°æ®åº“ç‰ˆæœ¬**: 003

