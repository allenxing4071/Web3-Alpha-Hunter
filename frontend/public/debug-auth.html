<!DOCTYPE html>
<html>
<head>
    <title>认证信息调试</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a2e;
            color: #fff;
        }
        .section {
            background: #16213e;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
        .key {
            color: #4ade80;
            font-weight: bold;
        }
        .value {
            color: #60a5fa;
        }
        pre {
            background: #0f1419;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>🔍 认证信息调试</h1>
    
    <div class="section">
        <h2>sessionStorage 内容:</h2>
        <div id="sessionStorage"></div>
    </div>
    
    <div class="section">
        <h2>localStorage 内容:</h2>
        <div id="localStorage"></div>
    </div>
    
    <div class="section">
        <h2>验证结果:</h2>
        <div id="validation"></div>
    </div>

    <script>
        // 显示 sessionStorage
        const sessionDiv = document.getElementById('sessionStorage');
        let sessionHTML = '';
        for (let i = 0; i < sessionStorage.length; i++) {
            const key = sessionStorage.key(i);
            const value = sessionStorage.getItem(key);
            sessionHTML += `<div><span class="key">${key}:</span> <span class="value">${value}</span></div>`;
        }
        sessionDiv.innerHTML = sessionHTML || '<div style="color: #ef4444;">Empty</div>';

        // 显示 localStorage
        const localDiv = document.getElementById('localStorage');
        let localHTML = '';
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            const value = localStorage.getItem(key);
            localHTML += `<div><span class="key">${key}:</span> <span class="value">${value}</span></div>`;
        }
        localDiv.innerHTML = localHTML || '<div style="color: #ef4444;">Empty</div>';

        // 验证
        const validationDiv = document.getElementById('validation');
        const token = sessionStorage.getItem('auth_token');
        const userStr = sessionStorage.getItem('auth_user');
        
        let validationHTML = '<pre>';
        validationHTML += `auth_token: ${token}\n`;
        validationHTML += `auth_token === 'authenticated': ${token === 'authenticated'}\n`;
        validationHTML += `auth_user: ${userStr}\n`;
        
        if (userStr) {
            try {
                const user = JSON.parse(userStr);
                validationHTML += `\nParsed user:\n${JSON.stringify(user, null, 2)}\n`;
                validationHTML += `\nRole: ${user.role}\n`;
                validationHTML += `Is Admin: ${user.role === 'admin'}\n`;
            } catch (e) {
                validationHTML += `\nParse Error: ${e.message}\n`;
            }
        }
        
        validationHTML += '\n=== 验证结果 ===\n';
        if (!token || token !== 'authenticated' || !userStr) {
            validationHTML += '❌ 验证失败: 缺少认证信息\n';
        } else {
            try {
                const user = JSON.parse(userStr);
                if (user.role !== 'admin') {
                    validationHTML += '❌ 验证失败: 非管理员用户\n';
                } else {
                    validationHTML += '✅ 验证通过: 管理员用户\n';
                }
            } catch (e) {
                validationHTML += '❌ 验证失败: 用户信息解析错误\n';
            }
        }
        validationHTML += '</pre>';
        
        validationDiv.innerHTML = validationHTML;
    </script>
</body>
</html>
